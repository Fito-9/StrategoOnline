<div class="principal-container">
  <h2 class="game-title">Buscar Usuarios</h2>
  <input
    type="text"
    placeholder="Buscar por nickname..."
    [(ngModel)]="searchTerm"
    (input)="searchUsers()"
    class="search-input"
  />

  <ul class="user-list">
    <li *ngFor="let user of filteredUsers">
      <div class="user-info">
        <img *ngIf="user.ruta; else noAvatar" [src]="user.ruta" alt="{{ user.nickname }}" class="user-avatar">
        <ng-template #noAvatar>
          <img src="assets/default-avatar.png" alt="Sin avatar" class="user-avatar">
        </ng-template>
        <span>{{ user.nickname }}</span>

        <!-- Estado de conexión -->
        <span *ngIf="isOnline(user.userId)" class="status online">🟢 Conectado</span>
        <span *ngIf="!isOnline(user.userId)" class="status offline">🔴 Desconectado</span>
      </div>

      <!-- Si el usuario ya es amigo, no mostramos el botón -->
      <button *ngIf="!friendIds.includes(user.userId)" (click)="sendFriendRequest(user.userId)" class="friend-request-button">
        Enviar solicitud
      </button>
      <span *ngIf="friendIds.includes(user.userId)" class="already-friends">Ya sois amigos</span>
    </li>
  </ul>

  <h2 class="game-title">Solicitudes Recibidas</h2>
  <ul class="request-list">
    <li *ngFor="let req of pendingRequests">
      <div class="request-info">
        <img *ngIf="req.senderAvatar; else noSenderAvatar" [src]="req.senderAvatar" alt="{{ req.senderNickname }}" class="user-avatar">
        <ng-template #noSenderAvatar>
          <img src="assets/default-avatar.png" alt="Sin avatar" class="user-avatar">
        </ng-template>
        <span>{{ req.senderNickname }}</span>

        <!-- Estado de conexión de la persona que envió la solicitud -->
        <span *ngIf="isOnline(req.senderId)" class="status online">🟢 Conectado</span>
        <span *ngIf="!isOnline(req.senderId)" class="status offline">🔴 Desconectado</span>
      </div>

      <div class="request-actions">
        <button (click)="acceptRequest(req.senderId)" class="accept-button">Aceptar</button>
        <button (click)="rejectRequest(req.senderId)" class="reject-button">Rechazar</button>
      </div>
    </li>
  </ul>
</div>
